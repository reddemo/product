<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="#" type="image/png">
    <title>买车帮</title>
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/jquery-ui-1.10.3.css" rel="stylesheet">
    <link href="fonts/css/font-awesome.min.css" rel="stylesheet">
    <link href="css/fonts.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet">
    <link rel="stylesheet" href="css/bootstrapValidator.css" />
    <!--multi-select-->
    <script type="text/tpl" id="prizetr">
        <%_.each(data,function(v){%>
            <tr>
                <td class="hidden-phone">
                    <%=v.prizename%>
                </td>
                <td>
                    <%=v.prizecount%>
                </td>
                <td>
                    <span class="label label-danger label-mini">
                                                                  删除
                                                                </span>
                </td>
            </tr>
            <%})%>
    </script>
    <link rel="stylesheet" type="text/css" href="js/jquery-multi-select/css/multi-select.css" />
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
  <script src="js/html5shiv.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
    <style type="text/css">
    .alike {
        background-color: #F9F9F9;
        border: none;
    }
    
    .alike:hover {
        text-decoration: underline;
    }
    
    .noa:hover {
        text-decoration: none;
    }
    
    #loading-container .spinner {
        display: inline-block;
    }
    </style>
</head>

<body class="sticky-header left-side-collapsed">
    <section id="bang-container">
        <!-- left side start-->
        <div class="left-side sticky-left-side bang-sider">
            <!--logo and iconic logo start-->
            <div class="logo">
                <a href="index.html"><img src="images/logo-bang.png" alt=""></a>
            </div>
            <div class="logo-icon text-center">
                <a href="index.html"><img src="images/logo_icon.png" alt=""></a>
            </div>
            <!--logo and iconic logo end-->
            <div class="left-side-inner">
                <!-- visible to small devices only -->
                <!--sidebar nav start-->
                <ul class="nav nav-pills nav-stacked custom-nav">
                    <li><a href="index.html"><i class="fa fa-home"></i> <span>猫咪</span></a></li>
                    <li class="menu-list nav-active"><a href=""><i class="fa fa-laptop"></i> <span>活动管理</span></a>
                        <ul class="sub-menu-list">
                            <li><a href="blank_page.html"> 活动列表</a></li>
                            <li><a href="boxed_view.html"> 添加活动</a></li>
                        </ul>
                    </li>
                    <li class="menu-list"><a href=""><i class="fa fa-book"></i> <span>经销商管理</span></a>
                        <ul class="sub-menu-list">
                            <li><a href="general.html"> 经销商列表</a></li>
                            <li><a href="buttons.html"> 发票列表</a></li>
                        </ul>
                    </li>
                    <li><a href="login.html"><i class="fa fa-sign-in"></i> <span>退出</span></a></li>
                </ul>
                <!--sidebar nav end-->
            </div>
        </div>
        <!-- left side end-->
        <!-- main content start-->
        <div class="main-content bang-main" style="padding-top:0;">
            <nav class="navbar navbar-default bang-header" role="navigation">
                <div class="container-fluid" style="padding-left:0;">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <a class="toggle-btn" style="margin-right:18px;"><i class="fa fa-bars"></i></a>
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                            <span class="sr-only">给我五分钟</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand" href="index.html" style="background-color:#fff;margin-top:-10px;">
                            <img src="img/emao-logo.png" alt="">
                        </a>
                    </div>
                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                        <ul class="nav navbar-nav">
                            <li class="active"><a href="index.html">一猫买车帮</a></li>
                            <li><a href="#">专题</a></li>
                            <li>
                                <a href="#">车讯</a>
                            </li>
                            <li><a href="#">广告平台</a></li>
                            <li>
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">猫咪</a>
                            </li>
                        </ul>
                        <ul class="nav navbar-nav navbar-right">
                            <li class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        你好，喵星人! &nbsp&nbsp <span>liulu123@emao.com</span> <b class="caret"></b>
                        </a>
                                <ul class="dropdown-menu">
                                    <li><a href="#">退出</a></li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <!-- /.navbar-collapse -->
                </div>
                <!-- /.container-fluid -->
            </nav>
            <!-- header section end-->
            <!-- page heading start-->
            <div class="page-heading bang-heading">
                <div class="row">
                    <div class="col-md-12">
                        <!--breadcrumbs start -->
                        <ul class="breadcrumb panel">
                            <li><a href="#"><i class="fa fa-home"></i> 买车帮活动</a></li>
                            <li class="active">录入奖品</li>
                        </ul>
                        <!--breadcrumbs end -->
                    </div>
                </div>
            </div>
            <!-- page heading end-->
            <!--body wrapper start-->
            <div class="wrapper bang-wrapper">
                <div class="row">
                    <form class="form-inline" role="form" style="margin-left:30px;margin-bottom:10px;">
                        <div class="form-group">
                            <label for="exampleInputEmail2">姓名:</label>
                            <input type="email" class="form-control" id="exampleInputEmail2" placeholder="name">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword2">手机号:</label>
                            <input type="password" class="form-control" id="exampleInputPassword2" placeholder="phone">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword2">身份证号:</label>
                            <input type="password" class="form-control" id="exampleInputPassword2" placeholder="id">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword2">品牌:</label>
                            <input type="password" class="form-control" id="exampleInputPassword2" placeholder="brand">
                        </div>
                        <div class="form-group">
                            <label for="exampleInputPassword2">品牌:</label>
                            <select class="form-control m-bot15" id="exampleInputPassword23" style="position:relative;top:8px;">
                                <option>Option 1</option>
                                <option>Option 2</option>
                                <option>Option 3</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">搜索</button>
                    </form>
                </div>
                <div class="row" id="bang-gift">
                    <div class="col-sm-12">
                        <section class="panel">
                            <header class="panel-heading">
                                奖品列表
                                <span class="tools pull-right">
                        <a href="javascript:;" class="fa fa-chevron-down"></a>
                        <a href="javascript:;" class="fa fa-times"></a>
                     </span>
                            </header>
                            <div class="panel-body">
                                <div class="adv-table editable-table ">
                                    <div class="clearfix">
                                        <div class="btn-group">
                                            <button id="editable-sample_new" class="editable-table-adder btn btn-primary">
                                                新增奖品 <i class="fa fa-plus"></i>
                                            </button>
                                            <ul class="pager" style="display:inline-block;margin:0 60px;">
                                                <li><a href="#">返回抽奖录入页面</a></li>
                                            </ul>
                                        </div>
                                        <div class="btn-group pull-right">
                                            <button class="btn btn-default dropdown-toggle" data-toggle="dropdown">工具 <i class="fa fa-angle-down"></i>
                                            </button>
                                            <ul class="dropdown-menu pull-right">
                                                <li><a href="#">打印</a></li>
                                                <li><a href="#">导出PDF</a></li>
                                                <li><a href="#">导出为表格</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="space15"></div>
                                    <form action="a.php" method="post">
                                        <table class="only-editable-table table table-striped table-hover table-bordered" id="editable-sample">
                                            <thead>
                                                <tr>
                                                    <th x-value="-">ID</th>
                                                    <th x-value="" class="editale-property" x-name="rang">奖品范围</th>
                                                    <th x-value="" class="editale-property" x-name="name">奖品名称</th>
                                                    <th x-value="-">创建时间</th>
                                                    <th x-value="-">修改时间</th>
                                                    <th x-value="-">创建人</th>
                                                    <th x-value="-">修改人</th>
                                                    <th class="action" x-value="<a class='edit' href='javascript:;'>编辑</a>
                                                    <a class='delete' href='javascript:;'>删除</a>
                                                    <a class='save' href='javascript:;'>保存</a>
                                                    <a class='cancel' href='javascript:;'>取消编辑</a>">
                                                        操作
                                                    </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr class="">
                                                    <td>1</td>
                                                    <td>1-99</td>
                                                    <td>车模</td>
                                                    <td class="center">2016-03-30</td>
                                                    <td class="center">2016-03-30</td>
                                                    <td class="center">创建人</td>
                                                    <td class="center">修改人</td>
                                                    <td class="table-action">
                                                        <a class="edit" href="javascript:;">编辑</a>
                                                        <a class="delete" href="javascript:;">删除</a>
                                                        <a class="save" href="javascript:;">
                                                            保存
                                                        </a>
                                                        <a class="cancel" href="javascript:;">取消编辑</a>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </form>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
                <div class="row">
                    <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="bang-alert" class="modal fade">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                                    <h4 class="modal-title"></h4>
                                </div>
                                <div class="modal-body">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger"> Ok</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="bang-edit" class="modal fade">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                                    <h4 class="modal-title"></h4>
                                </div>
                                <div class="modal-body">
                                    <div>
                                        <form action="#" class="form-horizontal " id="maybeRule">
                                            <div class="form-group">
                                                <label class="control-label col-md-3">奖品范围</label>
                                                <div class="col-md-4">
                                                    <div class="input-group input-large">
                                                        <input type="text" class="form-control dpd1" name="starttime" disabled>
                                                        <span class="input-group-addon">To</span>
                                                        <input type="text" class="form-control dpd2" name="endtime" disabled>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="control-label col-md-3" for="inputSuccess">奖品</label>
                                                <div class="col-lg-4">
                                                    <select class="form-control input-sm m-bot15" name="prizename" id="prizeInfo">
                                                        <option>猫女郎</option>
                                                        <option>车模</option>
                                                        <option>兰博基尼</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label class="control-label col-md-3">数量</label>
                                                <div class="col-lg-4">
                                                    <div class="input-group">
                                                        <input type="text" class="form-control" name="prizecount">
                                                        <span class="input-group-btn">
                                                            <button class="btn btn-default submit" type="button" >Go!</button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <form action="#" class="form-horizontal " id="prizerule">
                                            <input type="hidden" name="starttime" value="1">
                                            <input type="hidden" name="endtime" value="13">
                                            <input type="hidden" name="rule" value='[{"starttime":"1","endtime":"13","prize":"猫女郎","prizecount":"30"}]'>
                                            <table class="table  table-hover general-table" id="willRule">
                                                <thead>
                                                    <tr>
                                                        <th class="hidden-phone">
                                                            奖品名称
                                                        </th>
                                                        <th>
                                                            数量
                                                        </th>
                                                        <th>操作
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <!-- <tr>
                                                        <td class="hidden-phone">
                                                            猫女郎
                                                        </td>
                                                        <td>
                                                            556.00$
                                                        </td>
                                                        <td>
                                                            <span class="label label-danger label-mini">
                                                              删除
                                                            </span>
                                                        </td>
                                                    </tr> -->
                                                </tbody>
                                            </table>
                                        </form>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-danger"> Ok</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row" id="loading-container" style="text-align:center;">
                </div>
            </div>
            <!--body wrapper end-->
            <!--footer section start-->
            <footer class="sticky-footer bang-footer" style="text-align:center;">
                Have a nice day!
            </footer>
            <!--footer section end-->
        </div>
        <!-- main content end-->
    </section>
    <!-- Placed js at the end of the document so the pages load faster -->
    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="js/jquery-migrate-1.2.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/modernizr.min.js"></script>
    <script src="js/jquery.nicescroll.js"></script>
    <!--data table-->
    <script type="text/javascript" src="js/data-tables/jquery.dataTables.js"></script>
    <script type="text/javascript" src="js/data-tables/DT_bootstrap.js"></script>
    <!--common scripts for all pages-->
    <script src="js/scripts.js"></script>
    <script src="js/es6-promise.min.js"></script>
    <script src="js/underscore.min.js"></script>
    <!-- END JAVASCRIPTS -->
    <!--multi-select-->
    <script type="text/javascript" src="js/jquery-multi-select/js/jquery.multi-select.js"></script>
    <script type="text/javascript" src="js/jquery-multi-select/js/jquery.quicksearch.js"></script>
    <script src="js/multi-select-init.js"></script>
    <!--script for editable table-->
    <script src="script/underscore.js"></script>
    <script src="script/spin.js"></script>
    <script src="script/loading.js"></script>
    <!-- // <script src="script/editable-table.js"></script> -->
    <script src="script/modal.js"></script>
    <script src="script/config.js"></script>
    <script src="script/geturl.js"></script>
    <script src="script/http.js"></script>
    <!-- // <script src="script/app.js"></script> -->
    <script type="text/javascript" src="script/bootstrapValidator.min.js"></script>
    <script>
    // //编辑按钮事件
    // jQuery('#editable-sample').on('click', '.edit', function() { //编辑事件
    //     // console.log()
    //     var time = jQuery(this).closest('tr').find('td:eq(1)').html().split('-');
    //     var starttime = time[0];
    //     var endtime = time[1];

    //     getUrl({
    //         url: 'test/prize.json',
    //         data: {
    //             starttime: starttime,
    //             endtime: endtime
    //         },
    //         type: 'get',
    //         dataType: 'json'
    //     }).then(function(remote) {
    //         if (remote.code == 0) { //数据成功后
    //             var data = remote.data;
    //             prizeRule = data;
    //             var didRule = _.reduce(data, function(c, v, k, e) {
    //                 return c + renderPrizetrHtml(v);
    //             }, '');
    //             $('#willRule tbody').html(didRule);

    //             // $('#prizerule [name="rule"]').val(JSON.stringify(prizeRule));

    //             $("#bang-edit").modal({
    //                 title: time.join('-')
    //             });
    //             $('#prizerule [name="starttime"]').val(starttime);
    //             $('#prizerule [name="endtime"]').val(endtime);
    //             $('#maybeRule [name="starttime"]').val(starttime);
    //             $('#maybeRule [name="endtime"]').val(endtime);
    //         }
    //     })
    // });
    // //抽奖规则
    // var prizeRule = jQuery('#prizerule [name="rule"]').val();
    // var starttime = jQuery('#prizerule [name="starttime"]').val()
    // var endtime = jQuery('#prizerule [name="endtime"]').val();
    // var renderPrizetrHtml = _.template(jQuery('#prizetr').html());
    // // var didPrizeTableHTML=_.reduce()
    // var jqMaybeRule = $('#maybeRule');
    // var jqSumbit = $('#prizerule');
    // var jqPrizeRuleTable = $('#prizerule table tbody');
    // jqPrizeRuleTable.on('click', '.label-danger', function() {
    //     $(this).closest('tr').remove();
    // });
    // var jqModal = jQuery('#bang-edit');
    // jqModal.on('click', '.modal-footer .btn', function() {
    //     var data = jqSumbit.serializeArray();
    //     console.log(data)

    // });
    // jqMaybeRule.on('change', 'input,select', function() {
    //     jqMaybeRule.find('.submit').attr('disabled', false);
    // }); //当提交成功后禁用提交按钮，除非数据发生变化才可以再次提交
    // jqMaybeRule //提交部分规则
    //     .on('click', '.submit', function(e) {
    //         if (jqMaybeRule.data('bootstrapValidator').validate().$invalidFields.size()) {
    //             return;
    //         }
    //         var data = _.reduce(jqMaybeRule.serializeArray(), function(c, v, k, e) {
    //             c[v.name] = v.value;
    //             return c;
    //         }, {});


    //         getUrl({
    //             url: 'test/prize.json',
    //             data: data,
    //             type: 'get'
    //         }).
    //         then(function(remote) {
    //             if (remote.code == 0) {
    //                 var prizetrHtml = renderPrizetrHtml(data);
    //                 jqPrizeRuleTable.append(prizetrHtml);
    //                 prizeRule.push(data);
    //                 $('#prizerule [name="rule"]').val(JSON.stringify(prizeRule));
    //             } else {
    //                 alert(remote.message);
    //             }
    //         });
    //         $(this).prop('disabled', true);
    //         e.preventDefault();
    //         e.stopPropagation();
    //     })
    //     .bootstrapValidator({
    //         message: 'This value is not valid',
    //         fields: {
    //             starttime: {
    //                 message: '容我考虑一分钟',
    //                 validators: {
    //                     notEmpty: {
    //                         message: '不能为空'
    //                     },
    //                     stringLength: {
    //                         min: 1,
    //                         max: 4,
    //                         message: '数字必须在有效范围内'
    //                     },
    //                     /*remote: {
    //                         url: 'remote.php',
    //                         message: 'The username is not available'
    //                     },*/
    //                     regexp: {
    //                         regexp: /^\d+$/,
    //                         message: '必须是数字'
    //                     }
    //                 }
    //             },
    //             endtime: {
    //                 message: '容我考虑一分钟',
    //                 validators: {
    //                     notEmpty: {
    //                         message: '不能为空'
    //                     },
    //                     stringLength: {
    //                         min: 1,
    //                         max: 4,
    //                         message: '数字必须在有效范围内'
    //                     },
    //                     /*remote: {
    //                         url: 'remote.php',
    //                         message: 'The username is not available'
    //                     },*/
    //                     regexp: {
    //                         regexp: /^\d+$/,
    //                         message: '必须是数字'
    //                     }
    //                 }
    //             },
    //             prizename: {
    //                 validators: {
    //                     callback: {
    //                         callback: function(value) {
    //                             return !_.find(prizeRule, function(v) {
    //                                 return v.prizename == value;
    //                             });
    //                         },
    //                         message: '重复了'
    //                     }
    //                 }
    //             },
    //             prizecount: {
    //                 validators: {
    //                     notEmpty: {
    //                         message: ''
    //                     },
    //                     regexp: {
    //                         regexp: /^\d+$/,
    //                         message: '必须是数字'
    //                     },
    //                     callback: {
    //                         callback: function() {

    //                             if (parseInt(jqMaybeRule.find('[name="prizecount"]').val(), 10) > parseInt(jqMaybeRule.find('[name="endtime"]').val(), 10)) {

    //                                 return false;
    //                             }
    //                             return true;
    //                         },
    //                         message: '奖品数不能大于抽奖人数'
    //                     }
    //                 }
    //             }
    //         }
    //     });
    </script>
    <script type="text/javascript">
    function Bang() {

        var jqTable = jQuery('#editable-sample');
        var renderPrizetrHtml = _.template(jQuery('#prizetr').html());
        var prizeRules;
        var rang;

        function getPrizeRang(dom) {
            var time = jQuery(dom).closest('tr').find('td:eq(1)').html().split('-');
            return {
                starttime: time[0],
                endtime: time[1]
            }
        }

        jQuery('#maybeRule').on('change', 'input,select', function() {
            jQuery('#maybeRule').find('.submit').attr('disabled', false);
        });

        function getEditorByRang(rang) {
            getUrl({
                url: 'test/prize.json',
                data: rang,
                type: 'get',
                dataType: 'json'
            }).then(function(remote) {
                if (remote.code == 0) { //数据成功后
                    jQuery('#maybeRule [name="starttime"]').prop('disabled', true);
                    jQuery('#maybeRule [name="endtime"]').prop('disabled', true);
                    var data = remote.data;
                    prizeRules = data.prizeRules;
                    var didRule = renderPrizetrHtml({
                            data: prizeRules
                        })
                        // console.log(data)
                    $('#willRule tbody').html(didRule);
                    $('#prizeInfo').html(_.reduce(data.prizeInfo, function(c, v, k, e) {
                        return c + '<option value="' + v.prizename + '">' + v.prizename + '(剩余：' + v.rest + ')</option>'
                    }, ''))

                    // $('#prizerule [name="rule"]').val(JSON.stringify(prizeRule));

                    $("#bang-edit").modal({
                        title: rang.starttime + '-' + rang.endtime
                    });
                    $('#prizerule [name="starttime"]').val(rang.starttime);
                    $('#prizerule [name="endtime"]').val(rang.endtime);
                    $('#maybeRule [name="starttime"]').val(rang.starttime);
                    $('#maybeRule [name="endtime"]').val(rang.endtime);
                }
            })
        }

        function getAdd() {
            getUrl({
                url: 'test/prize.json',
                type: 'get',
                dataType: 'json'
            }).then(function(remote) {
                if (remote.code == 0) { //数据成功后
                    jQuery('#maybeRule [name="starttime"]').prop('disabled', false);
                    jQuery('#maybeRule [name="endtime"]').prop('disabled', false);
                    var data = remote.data;
                    prizeRules = []
                        // console.log(data)
                    $('#prizeInfo').html(_.reduce(data.prizeInfo, function(c, v, k, e) {
                        return c + '<option value="' + v.prizename + '">' + v.prizename + '(剩余：' + v.rest + ')</option>'
                    }, ''))
                    $('#willRule tbody').html('');
                    // $('#prizerule [name="rule"]').val(JSON.stringify(prizeRule));

                    $("#bang-edit").modal({
                        title: '新增'
                    });
                    $('#prizerule [name="starttime"]').val(rang.starttime);
                    $('#prizerule [name="endtime"]').val(rang.endtime);
                    $('#maybeRule [name="starttime"]').val(rang.starttime);
                    $('#maybeRule [name="endtime"]').val(rang.endtime);
                }
            })
        }

        function handleEdit() {
            jqTable.on('click', '.edit', function() {
                rang = getPrizeRang(this);
                getEditorByRang(rang);
            });
            checkData();
            remove();
            jQuery('#bang-edit').on('click', '.modal-footer .btn-danger', function() {
                submitWill();
            });
        }


        function checkData() {
            var checkRules = {
                starttime: {
                    message: '容我考虑一分钟',
                    validators: {
                        notEmpty: {
                            message: '不能为空'
                        },
                        stringLength: {
                            min: 1,
                            max: 4,
                            message: '数字必须在有效范围内'
                        },
                        /*remote: {
                            url: 'remote.php',
                            message: 'The username is not available'
                        },*/
                        regexp: {
                            regexp: /^\d+$/,
                            message: '必须是数字'
                        }
                    }
                },
                endtime: {
                    message: '容我考虑一分钟',
                    validators: {
                        notEmpty: {
                            message: '不能为空'
                        },
                        stringLength: {
                            min: 1,
                            max: 4,
                            message: '数字必须在有效范围内'
                        },
                        regexp: {
                            regexp: /^\d+$/,
                            message: '必须是数字'
                        }
                    }
                },
                prizename: {
                    validators: {
                        callback: {
                            callback: function(value) {
                                return !_.find(prizeRules, function(v) {
                                    return v.prizename == value;
                                });
                            },
                            message: '重复了'
                        }
                    }
                },
                prizecount: {
                    validators: {
                        notEmpty: {
                            message: ''
                        },
                        regexp: {
                            regexp: /^\d+$/,
                            message: '必须是数字'
                        },
                        callback: {
                            callback: function() {

                                if (parseInt(jqMaybeRule.find('[name="prizecount"]').val(), 10) > parseInt(jqMaybeRule.find('[name="endtime"]').val(), 10)) {

                                    return false;
                                }
                                return true;
                            },
                            message: '奖品数不能大于抽奖人数'
                        }
                    }
                }
            }
            var jqMaybeRule = jQuery("#maybeRule")
            jqMaybeRule.bootstrapValidator({
                message: 'This value is not valid',
                fields: checkRules
            }).on('click', '.submit', function(e) {
                if (jqMaybeRule.data('bootstrapValidator').validate().$invalidFields.size()) {
                    return;
                }
                var data = _.reduce(jqMaybeRule.serializeArray(), function(c, v, k, e) {
                    c[v.name] = v.value;
                    return c;
                }, {});


                getUrl({
                    url: 'test/prize.json',
                    data: data,
                    type: 'get'
                }).
                then(function(remote) {
                    if (remote.code == 0) {
                        var finedSame = _.find(prizeRules, function(v) {
                            // console.log(v.name,data.name)
                            return v.prizename == data.prizename
                        });
                        if (finedSame) {
                            alert('重复了');
                        } else {
                            prizeRules.push(data);
                            var prizetrHtml = renderPrizetrHtml({
                                data: prizeRules
                            });
                            jQuery('#willRule tbody').html(prizetrHtml);
                            $('#prizerule [name="rule"]').val(JSON.stringify(prizeRules));
                        }
                        $(this).prop('disabled', true);
                    } else {
                        alert(remote.message);
                    }
                });
                e.preventDefault();
                e.stopPropagation();
            });
        }

        function submitMaybe() {

        }

        function remove() {
            jQuery('#willRule').on('click', '.label-danger', function() {
                var tr = $(this).closest('tr');
                tr.remove();
                prizeRules = _.reject(prizeRules, function(v) {
                    return v.prizename == jQuery.trim(tr.find('td').eq(0).html())
                });
            })
        }

        function submitWill() {
            getUrl({
                url: 'test/prize.json',
                type: 'get',
                dataType: 'json',
                data: _.extend(rang, prizeRules)
            })
        }


        // function edit() {
        //     jQuery('').on('click', function() {

        //         jQuery('#maybeRule [name="starttime"]').prop('disabled', true);
        //         jQuery('#maybeRule [name="endtime"]').prop('disabled', true);
        //     })
        // }
        function handleAdd() {
            jQuery('#editable-sample_new').on('click', function() {
                jQuery('#maybeRule [name="starttime"]').prop('disabled', false);
                jQuery('#maybeRule [name="endtime"]').prop('disabled', false);
                getAdd();
            })
        }
        return {
            init: function() {
                handleEdit();
                handleAdd()
            }
        }
    }
    </script>
    <script type="text/javascript">
    var bang = new Bang();
    bang.init();
    </script>
</body>

</html>
